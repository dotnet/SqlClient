<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!--
    This file contains the Abstractions package version information.  It is
    separate from the Abstractions .csproj file so these versions can be
    imported into the overall MDS build without including other project
    variables.

    Private properties, not intended to be set or used externally, are prefixed
    with an underscore (_).
  -->

  <!--
    This file uses the $(BuildNumber) property defined in
    tools/props/Versions.props.
  -->

  <!-- Versioning Properties -->
  <PropertyGroup>
    <!--
      We accept two public properties to control versioning:

        AbstractionsPackageVersion:
          - Used as the NuGet package version, both in the package file name
            and in the package metadata.
          - Used as the base value of the assembly attribute
            'AssemblyInformationalVersion' generated by MSBuild.
          - If not specified, defaults to:
              $(DefaultMajorVersion).0.0.$(BuildNumber)-dev.

        AbstractionsAssemblyFileVersion:
          - Used as the value of the assembly attribute 'AssemblyFileVersion'
            generated by MSBuild.
          - If not specified:
            - If $(AbstractionsPackageVersion) is specified, use the numeric
              parts of its value, for example 1.0.0.345.
            - Otherwise, defaults to:
              $(DefaultMajorVersion).0.0.$(BuildNumber).
    
      We use private properties to hold the computed values, and then always
      assign those to the public properties.  After importing this file, the
      public properties will always be set.
    -->

    <!-- The default major version number. -->
    <AbstractionsDefaultMajorVersion>1</AbstractionsDefaultMajorVersion>

    <!-- Determine the package version. -->
    <_OurPackageVersion Condition="'$(AbstractionsPackageVersion)' != ''">$(AbstractionsPackageVersion)</_OurPackageVersion>
    <_OurPackageVersion Condition="'$(AbstractionsPackageVersion)' == ''">$(AbstractionsDefaultMajorVersion).0.0.$(BuildNumber)-dev</_OurPackageVersion>

    <!--Determine the assembly file version. -->
    <!-- If AbstractionsAssemblyFileVersion is set, use its value as-is. -->
    <_OurAssemblyFileVersion Condition="'$(AbstractionsAssemblyFileVersion)' != ''">$(AbstractionsAssemblyFileVersion)</_OurAssemblyFileVersion>
    <!-- If AbstractionsPackageVersion is set, use its trimmed value. -->
    <_OurAssemblyFileVersion Condition="'$(AbstractionsAssemblyFileVersion)' == '' and '$(AbstractionsPackageVersion)' != ''">$(AbstractionsPackageVersion.Split('-')[0])</_OurAssemblyFileVersion>
    <!-- If neither property is set, use the default value.-->
    <_OurAssemblyFileVersion Condition="'$(AbstractionsAssemblyFileVersion)' == '' and '$(AbstractionsPackageVersion)' == ''">$(AbstractionsDefaultMajorVersion).0.0.$(BuildNumber)</_OurAssemblyFileVersion>

    <!--
      Assign the public properties.  This has no effect if they were
      specified on the command-line, in which case they are read-only.
    -->
    <AbstractionsPackageVersion>$(_OurPackageVersion)</AbstractionsPackageVersion>
    <AbstractionsAssemblyFileVersion>$(_OurAssemblyFileVersion)</AbstractionsAssemblyFileVersion>

  </PropertyGroup>

</Project>
