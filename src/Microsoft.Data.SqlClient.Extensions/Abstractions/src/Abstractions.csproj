<?xml version="1.0" encoding="utf-8"?>
<Project Sdk="Microsoft.NET.Sdk">

  <!--
    Additional project config is imported from parent Directory.Build.props
    files.
  -->

  <!-- Versioning Properties -->
  <PropertyGroup>
    <!--
      We accept two external properties to control versioning:

        AbstractionsPackageVersion:
          - Used as the NuGet package version, both in the package file name
            and in the package metadata.
          - Used as the base value of the assembly attribute
            'AssemblyInformationalVersion' generated by MSBuild.
          - If not specified, defaults to:
              $(DefaultMajorVersion).0.0.$(BuildNumber)-dev.
        
        AbstractionsAssemblyFileVersion:
          - Used as the value of the assembly attribute 'AssemblyFileVersion'
            generated by MSBuild.
          - If not specified:
            - If $(AbstractionsPackageVersion) is specified, use the numeric
              parts of its value, for example 1.0.0.345.
            - Otherwise, defaults to:
              $(DefaultMajorVersion).0.0.$(BuildNumber).
    -->

    <!-- The default major version number. -->
    <DefaultMajorVersion>1</DefaultMajorVersion>

    <!-- Determine the assembly file version. -->
    <!-- If AbstractionsAssemblyFileVersion is set, use its value as-is. -->
    <OurAssemblyFileVersion Condition="'$(AbstractionsAssemblyFileVersion)' != ''">$(AbstractionsAssemblyFileVersion)</OurAssemblyFileVersion>
    <!-- If AbstractionsPackageVersion is set, use its trimmed value. -->
    <OurAssemblyFileVersion Condition="'$(AbstractionsAssemblyFileVersion)' == '' and '$(AbstractionsPackageVersion)' != ''">$(AbstractionsPackageVersion.Split('-')[0])</OurAssemblyFileVersion>
    <!-- If neither property is set, use the default value.-->
    <OurAssemblyFileVersion Condition="'$(AbstractionsAssemblyFileVersion)' == '' and '$(AbstractionsPackageVersion)' == ''">$(DefaultMajorVersion).0.0.$(BuildNumber)</OurAssemblyFileVersion>
    
    <!-- Determine the package version. -->
    <OurPackageVersion Condition="'$(AbstractionsPackageVersion)' != ''">$(AbstractionsPackageVersion)</OurPackageVersion>
    <OurPackageVersion Condition="'$(AbstractionsPackageVersion)' == ''">$(DefaultMajorVersion).0.0.$(BuildNumber)-dev</OurPackageVersion>
  </PropertyGroup>

  <!-- Target Config -->
  <PropertyGroup>
    <TargetFrameworks>netstandard2.0</TargetFrameworks>
  </PropertyGroup>

  <!-- Compiler Config -->
  <PropertyGroup>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
  </PropertyGroup>

  <!-- Build Config -->
  <PropertyGroup>
    <AssemblyName>Microsoft.Data.SqlClient.Extensions.Abstractions</AssemblyName>
    <RootNamespace>Microsoft.Data.SqlClient.Extensions.Abstractions</RootNamespace>

    <!--
      We pin the AssemblyVersion of our package to the default major version
      number, with all remaining parts set to 0.
    -->
    <AssemblyVersion>$(DefaultMajorVersion).0.0.0</AssemblyVersion>

    <AssemblyFileVersion>$(OurAssemblyFileVersion)</AssemblyFileVersion>
    <FileVersion>$(OurAssemblyFileVersion)</FileVersion>
    <Version>$(OurPackageVersion)</Version>
  </PropertyGroup>
  <ItemGroup>
    <!-- Our API is CLS Compliant. -->
    <AssemblyAttribute Include="System.CLSCompliantAttribute">
      <_Parameter1>true</_Parameter1>
    </AssemblyAttribute>

    <!-- Our unit tests have access to our internal types. -->
    <InternalsVisibleTo Include="Microsoft.Data.SqlClient.Extensions.Abstractions.Test" />
  </ItemGroup>

  <!--
    NuGet Package Config

    See: https://learn.microsoft.com/en-us/nuget/reference/msbuild-targets#pack-target
  -->
  <PropertyGroup>
    <PackageId>$(AssemblyName)</PackageId>
    <PackageVersion>$(OurPackageVersion)</PackageVersion>
    <PackageOutputPath>$(PackagesDir)</PackageOutputPath>
    <IncludeSymbols>true</IncludeSymbols>
    <SymbolPackageFormat>snupkg</SymbolPackageFormat>

    <!--
      The parent Directory.Build.props file unilaterally adds '.pdb' to the
      file types that are included in application packages.  We don't want this
      behaviour, so we must reset this NuGet property to its original value.
    -->
    <AllowedOutputExtensionsInPackageBuildOutputFolder>$(OriginalAllowedOutputExtensions)</AllowedOutputExtensionsInPackageBuildOutputFolder>
    
    <Authors>Microsoft Corporation</Authors>
    <Company>Microsoft Corporation</Company>
    <Description>Microsoft.Data.SqlClient Extensions Abstractions</Description>
    <RepositoryUrl>https://github.com/dotnet/SqlClient</RepositoryUrl>
    <PackageLicenseExpression>MIT</PackageLicenseExpression>
    <PackageIcon>dotnet.png</PackageIcon>
  </PropertyGroup>
  <ItemGroup>
    <None Include="../../../../tools/icons/dotnet.png" Pack="true" PackagePath="/" />
  </ItemGroup>

</Project>
