<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <!-- @TODO: Use full assembly name here -->
    <AssemblyName>UnitTests</AssemblyName>
    <RootNamespace />
    <IsTestProject>true</IsTestProject>
    <Nullable>enable</Nullable>
  </PropertyGroup>

  <!-- Embedded resources and content files  =========================== -->
  <ItemGroup>
    <EmbeddedResource Update="Resources.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>Resources.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <Compile Update="Resources.Designer.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>Resources.resx</DependentUpon>
    </Compile>
    <ContentWithTargetPath Include="$(TestsPath)tools/Microsoft.Data.SqlClient.TestUtilities/xunit.runner.json">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <TargetPath>xunit.runner.json</TargetPath>
    </ContentWithTargetPath>

    <!-- Ensure that the SNI binaries are copied into the output directory -->
    <!-- @TODO: Can we find a way to eliminate this? -->
    <ContentWithTargetPath Include="$(RepoRoot)artifacts/Microsoft.Data.SqlClient/$(Configuration)/windows_nt/$(TargetFramework)/*SNI*.dll"
                           Condition="'$(TargetFramework)' == 'net462'">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
      <TargetPath>%(Filename)%(Extension)</TargetPath>
    </ContentWithTargetPath>
  </ItemGroup>

  <!-- References ====================================================== -->
  <!-- Test target reference -->
  <ItemGroup>
    <ProjectReference Include="$(RepoRoot)src/Microsoft.Data.SqlClient/src/Microsoft.Data.SqlClient.csproj" />
  </ItemGroup>

  <!-- References for all platforms -->
  <ItemGroup>
    <PackageReference Include="Microsoft.DotNet.XUnitExtensions" />
    <PackageReference Include="Microsoft.NET.Test.Sdk" />
    <PackageReference Include="Microsoft.SqlServer.Server" />
    <PackageReference Include="System.Configuration.ConfigurationManager" />
    <PackageReference Include="xunit" />
    <PackageReference Include="xunit.runner.console">
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
    <PackageReference Include="xunit.runner.visualstudio">
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>

    <ProjectReference Include="$(TestsPath)tools\TDS\TDS.Servers\TDS.Servers.csproj" />
    <ProjectReference Include="$(TestsPath)tools\TDS\TDS.EndPoint\TDS.EndPoint.csproj" />
    <ProjectReference Include="$(TestsPath)tools\TDS\TDS\TDS.csproj" />
    <ProjectReference Include="$(TestsPath)Common\Common.csproj" />
  </ItemGroup>

  <!-- References for netframework -->
  <ItemGroup Condition="'$(TargetFramework)' == 'net462'">
    <Reference Include="System.Transactions" />

    <PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies">
      <IncludeAssets>runtime; build; native; contentfiles; analyzers; buildtransitive</IncludeAssets>
      <PrivateAssets>all</PrivateAssets>
    </PackageReference>
    <PackageReference Include="System.Runtime.InteropServices.RuntimeInformation" />
  </ItemGroup>
</Project>
