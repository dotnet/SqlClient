<Project Sdk="Microsoft.NET.Sdk">
	<!-- General Properties ============================================== -->
  <PropertyGroup>
    <Configurations>Debug;Release;</Configurations>
    <RootNamespace />
		<AllowUnsafeBlocks>true</AllowUnsafeBlocks>
	</PropertyGroup>

  <!-- OS Constants ==================================================== -->
  <PropertyGroup>
    <!-- @TODO: Move to directory.build.props? -->
    <!-- If a target OS was not specified, use the current OS as the target OS. -->
    <TargetOs Condition="'$(TargetOs)' == ''">$(OS)</TargetOs>

    <!-- Uncomment the following line to override the OS you are developing for -->
    <!--<TargetOs>Unix</TargetOs>-->
    <!--<TargetOs>Windows_NT</TargetOs>-->

    <!-- NOTE: These constants are prefixed with _ to keep them separate from .NET 5+ precompiler -->
    <!--     flags. Those only apply to OS-specific target frameworks, and would interfere here.  -->
    <DefineConstants Condition="'$(TargetOs.ToUpper())' == 'UNIX'">$(DefineConstants);_UNIX</DefineConstants>
    <DefineConstants Condition="'$(TargetOs.ToUpper())' == 'WINDOWS_NT'">$(DefineConstants);_WINDOWS</DefineConstants>
  </PropertyGroup>

  <!-- Target Frameworks =============================================== -->
  <PropertyGroup>
    <!-- net462 is only supported on Windows, so we will only add it if we're building for Windows -->
    <TargetFrameworks>net8.0;net9.0</TargetFrameworks>
    <TargetFrameworks Condition="'$(TargetOs.ToUpper())' == 'WINDOWS_NT'">$(TargetFrameworks);net462</TargetFrameworks>
  </PropertyGroup>

  <!-- Build Output ==================================================== -->
  <PropertyGroup>
    <!-- @TODO: Move to directory.build.props? -->
    <ArtifactPath>$(RepoRoot)artifacts/</ArtifactPath>

    <!-- MSBuild will add the target framework to the end of this path by default. Telling it not -->
    <!-- to is possible but requires also specifying the IntermediateOutputPath. So while it      -->
    <!-- would be nice to have a flat directory structure, it's more hassle than its worth.       -->
    <OutputPath>$(ArtifactPath)$(AssemblyName)/$(Configuration)/$(TargetOs.ToLower())/</OutputPath>
  </PropertyGroup>

  <!-- Embedded resources ============================================== -->
  <ItemGroup>
    <!-- Linker directives to replace UseManagedNetworking with a constant if consumer specifies  -->
    <!-- the app context switch in their csproj. This file only applies to netcore on windows.    -->
    <!-- This file does not support pre-processor directives, so it must be conditionally         -->
    <!-- included into the build.                                                                 -->
    <EmbeddedResource Include="Resources/ILLink.Substitutions.xml"
                      Condition="'$(TargetOs.ToUpper())' == 'WINDOWS_NT' AND '$(TargetFramework)' == 'net462'" />
  </ItemGroup>

  <!-- References ====================================================== -->
  <!-- References that apply to all target frameworks -->
  <ItemGroup>
    <PackageReference Include="Azure.Core" />
    <PackageReference Include="Azure.Identity" />
    <PackageReference Include="Microsoft.Bcl.Cryptography" />
    <PackageReference Include="Microsoft.Extensions.Caching.Memory" />
    <PackageReference Include="Microsoft.IdentityModel.JsonWebTokens" />
    <PackageReference Include="Microsoft.IdentityModel.Protocols.OpenIdConnect" />
    <PackageReference Include="System.Security.Cryptography.Pkcs"  />
  </ItemGroup>

  <!-- References that only apply to net462 -->
  <ItemGroup Condition="'$(TargetFramework)' == 'net462'">
    <Reference Include="System.Configuration" />
    <Reference Include="System.EnterpriseServices" />
    <Reference Include="System.Transactions" />
    <PackageReference Include="System.ValueTuple" />
    <PackageReference Include="System.Threading.Channels" />
	</ItemGroup>

  <!-- References that only apply to netcore -->
  <ItemGroup Condition="'$(TargetFramework)' != 'net462'">
    <PackageReference Include="Microsoft.SqlServer.Server" />
    <PackageReference Include="System.Configuration.ConfigurationManager" />

    <!-- References that only apply to netcore < 10 -->
    <PackageReference Include="System.Buffers"
                      Condition="$([MSBuild]::VersionLessThan($([MSBuild]::GetTargetFrameworkVersion($(TargetFramework))), '10.0'))" />
    <PackageReference Include="System.Memory"
                      Condition="$([MSBuild]::VersionLessThan($([MSBuild]::GetTargetFrameworkVersion($(TargetFramework))), '10.0'))" />
    <PackageReference Include="System.Runtime.InteropServices.RuntimeInformation"
                      Condition="$([MSBuild]::VersionLessThan($([MSBuild]::GetTargetFrameworkVersion($(TargetFramework))), '10.0'))" />
  </ItemGroup>

  <!-- CodeGen Targets ================================================= -->
  <Import Project="$(ToolsDir)targets\GenerateThisAssemblyCs.targets" />
</Project>
