<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <Target Name="GenerateThisAssemblyCs"
          Inputs="$(MSBuildThisFileFullPath)"
          Outputs="$(IntermediateOutputPath)ThisAssembly.cs"
          BeforeTargets="CoreCompile">

    <PropertyGroup>

      <!-- Put the ThisAssembly class in the System namespace by default. -->
      <ThisAssemblyNamespace Condition="'$(ThisAssemblyNamespace)' == ''">System</ThisAssemblyNamespace>

      <ThisAssemblyCsContents>
// Licensed to the .NET Foundation under one or more agreements.
// The .NET Foundation licenses this file to you under the MIT license.

namespace $(ThisAssemblyNamespace)
{
    internal static class ThisAssembly
    {
        internal const string InformationalVersion = "$(AssemblyFileVersion)"%3B
        internal const string NuGetPackageVersion = "$(Version)"%3B
    }
}
      </ThisAssemblyCsContents>
    </PropertyGroup>

    <!-- Write ThisAssembly.cs if this is a new version number, or if it is missing. -->
    <WriteLinesToFile
      File="$(IntermediateOutputPath)ThisAssembly.cs"
      Lines="$(ThisAssemblyCsContents)"
      Overwrite="true"
      Encoding="Unicode"/>

  </Target>

  <!-- Ensure the generated ThisAssembly.cs is included in the compilation. -->
  <ItemGroup>
    <Compile Include="$(IntermediateOutputPath)ThisAssembly.cs"/>
    <FileWrites Include="$(IntermediateOutputPath)ThisAssembly.cs"/>
  </ItemGroup>
</Project>
