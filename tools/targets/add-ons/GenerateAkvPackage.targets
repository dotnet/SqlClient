<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="GenerateAkvPackage" Condition="'$(GenerateNuget)' == 'true'">
    <!-- Get the current commit id and store it in CommitId property to be used in nuget pack command -->
    <Exec Command="git rev-parse HEAD" ConsoleToMSBuild="true">
      <Output TaskParameter="ConsoleOutput" PropertyName="CommitId" />
    </Exec>
    <Message Text="Commit Id = $(CommitId)" />
    <Exec Command="powershell.exe -NonInteractive -executionpolicy Unrestricted ^
      -command &quot;&amp;$(ToolsDir)scripts\downloadLatestNuget.ps1 -nugetDestPath '$(NuGetRoot)'&quot;" />
    <Exec Command="$(NuGetCmd) pack $(ToolsDir)specs\add-ons\Microsoft.Data.SqlClient.AlwaysEncrypted.AzureKeyVaultProvider.nuspec -Version $(AkvPackageVersion) -Symbols -SymbolPackageFormat snupkg -OutputDirectory $(PackagesDir) -properties &quot;Configuration=$(Configuration);COMMITID=$(CommitId);MdsPackageVersion=$(MdsPackageVersion)&quot;" />
  </Target>
</Project>
