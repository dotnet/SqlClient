# Release Notes

## [Stable Release] 6.1.4 - 2026-01-15

### Fixed

- Fixed NullReferenceException issue with `SqlDataAdapter` when processing batch scenarios where certain SQL RPC calls may not include system parameters
  ([#3877](https://github.com/dotnet/SqlClient/pull/3877))

- Fixed connection pooling issue where extra connection deactivation was causing active connection counts to go negative
  ([#3776](https://github.com/dotnet/SqlClient/pull/3776))

### Added

#### Application Context Switch for MultiSubnetFailover

*What Changed:*

- Added new application context switch `Switch.Microsoft.Data.SqlClient.EnableMultiSubnetFailoverByDefault` to set `MultiSubnetFailover=true` by default in connection string
  ([#3851](https://github.com/dotnet/SqlClient/pull/3851))

*Who Benefits:*

- Applications that need MultiSubnetFailover enabled globally without modifying connection strings
- Applications deployed in multi-subnet environments that require automatic failover capabilities

*Impact:*

- Applications can now enable MultiSubnetFailover globally using one of the following methods:

```c#
// In application code
AppContext.SetSwitch("Switch.Microsoft.Data.SqlClient.EnableMultiSubnetFailoverByDefault", true);
```

```json
// In runtimeconfig.json
{
  "configProperties": {
    "Switch.Microsoft.Data.SqlClient.EnableMultiSubnetFailoverByDefault": true
  }
}
```

```xml
<!-- In App.Config -->
<runtime>
  <AppContextSwitchOverrides value="Switch.Microsoft.Data.SqlClient.EnableMultiSubnetFailoverByDefault=true" />
</runtime>
```

### Changed

#### Dependency Updates

*What Changed:*

- Updated dependencies to avoid deprecation warnings and security vulnerabilities. Major version upgrades include Microsoft.IdentityModel.Abstractions (8.14.0) and System.Diagnostics.DiagnosticSource updates across target frameworks
  ([#3843](https://github.com/dotnet/SqlClient/pull/3843))

*Who Benefits:*

- All users benefit from updated security patches and removal of deprecated dependencies

*Impact:*

- Applications using Microsoft.Data.SqlClient will receive updated transitive dependencies automatically
- Removed unused dependencies to reduce package size and attack surface

#### Performance Optimization for SqlStatistics

*What Changed:*

- Optimized `SqlStatistics` execution timing by using `Environment.TickCount` instead of more expensive timing mechanisms
  ([#3830](https://github.com/dotnet/SqlClient/pull/3830))

*Who Benefits:*

- Applications using SqlStatistics for performance monitoring
- High-throughput applications that rely on execution timing statistics

*Impact:*

- Improved performance when SqlStatistics are enabled
- More efficient timing collection with reduced overhead

## Contributors

There were no public contributors for this release. All contributions were made by the core Microsoft team.

## Target Platform Support

- .NET Framework 4.6.2+ (Windows x86, Windows x64)
- .NET 8.0+ (Windows x86, Windows x64, Windows ARM64, Linux, macOS)
- .NET Standard 2.0+ (Windows x86, Windows x64, Windows ARM64, Linux, macOS)

### Dependencies

#### .NET Framework 4.6.2

- Azure.Core 1.49.0
- Azure.Identity 1.16.0
- Microsoft.Bcl.Cryptography 8.0.0
- Microsoft.Data.SqlClient.SNI 6.0.2
- Microsoft.Extensions.Caching.Memory 8.0.1
- Microsoft.IdentityModel.JsonWebTokens 8.14.0
- Microsoft.IdentityModel.Protocols.OpenIdConnect 8.14.0
- System.Buffers 4.6.1
- System.Diagnostics.DiagnosticSource 8.0.1
- System.Memory 4.6.3
- System.Runtime.InteropServices.RuntimeInformation 4.3.0
- System.Security.Cryptography.Pkcs 8.0.1
- System.Text.Json 8.0.6
- System.Threading.Channels 8.0.0
- System.ValueTuple 4.6.1

#### .NET Standard 2.0

- Azure.Core 1.49.0
- Azure.Identity 1.16.0
- Microsoft.Bcl.Cryptography 8.0.0
- Microsoft.Data.SqlClient.SNI.runtime 6.0.2
- Microsoft.Extensions.Caching.Memory 8.0.1
- Microsoft.IdentityModel.JsonWebTokens 8.14.0
- Microsoft.IdentityModel.Protocols.OpenIdConnect 8.14.0
- Microsoft.SqlServer.Server 1.0.0
- System.Configuration.ConfigurationManager 8.0.1
- System.Security.Cryptography.Pkcs 8.0.1
- System.Text.Json 8.0.6
- System.Threading.Channels 8.0.0

#### .NET 8.0

- Azure.Core 1.49.0
- Azure.Identity 1.16.0
- Microsoft.Bcl.Cryptography 8.0.0
- Microsoft.Data.SqlClient.SNI.runtime 6.0.2
- Microsoft.Extensions.Caching.Memory 8.0.1
- Microsoft.IdentityModel.JsonWebTokens 8.14.0
- Microsoft.IdentityModel.Protocols.OpenIdConnect 8.14.0
- Microsoft.SqlServer.Server 1.0.0
- System.Configuration.ConfigurationManager 8.0.1
- System.Security.Cryptography.Pkcs 8.0.1

#### .NET 9.0

- Azure.Core 1.49.0
- Azure.Identity 1.16.0
- Microsoft.Bcl.Cryptography 9.0.9
- Microsoft.Data.SqlClient.SNI.runtime 6.0.2
- Microsoft.Extensions.Caching.Memory 9.0.9
- Microsoft.IdentityModel.JsonWebTokens 8.14.0
- Microsoft.IdentityModel.Protocols.OpenIdConnect 8.14.0
- Microsoft.SqlServer.Server 1.0.0
- System.Configuration.ConfigurationManager 9.0.9
- System.Security.Cryptography.Pkcs 9.0.9