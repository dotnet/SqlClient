#################################################################################
# Licensed to the .NET Foundation under one or more agreements.                 #
# The .NET Foundation licenses this file to you under the MIT license.          #
# See the LICENSE file in the project root for more information.                #
#################################################################################
parameters:
  - name: debug
    type: boolean
    default: false

  - name: downloadedNugetPath # path to the downloaded nuget files
    type: string

steps:
- powershell: |
    # Get a list of package sources available
    Get-PackageSource

    #Current location
    Get-Location

    # Register the local nuget folder to be used by nuget.config
    Register-PackageSource  -Name "Package Source" -Location ${{parameters.downloadedNugetPath }} -Force -ProviderName NuGet -Trusted

    # Get a list of package sources available after the change
    Get-PackageSource

    #Set the NuGet.config file in the project to use extracted package
    $rootFolder = Get-location
    [Xml] $nugetConfig = Get-Content -Path "NuGet.config"
    $Value = Resolve-Path ${{parameters.downloadedNugetPath }}
    $newAdd = $nugetConfig.CreateElement("add")
    $newAdd.SetAttribute("key","pipeline")
    $newAdd.SetAttribute("value", "$Value/" )
    $nugetConfig.configuration.packageSources.AppendChild($newAdd)
    $nugetConfig.Save("$rootFolder/NuGet.config")
  displayName: 'Update NuGet config file to read from Nuget folder'

- ${{ if parameters.debug }}:
  - powershell: |
      # Display the content of the NuGet.config file
      Get-Content -Path "NuGet.config"
    displayName: 'Read NuGet.config [debug]'
