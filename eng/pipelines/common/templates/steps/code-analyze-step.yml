#################################################################################
# Licensed to the .NET Foundation under one or more agreements.                 #
# The .NET Foundation licenses this file to you under the MIT license.          #
# See the LICENSE file in the project root for more information.                #
#################################################################################

# This template defines a step to run Roslyn Analyzers on the MDS project build.
# It uses the RoslynAnalyzers@3 task from the Secure Development Team's SDL
# extension:
#
# https://eng.ms/docs/cloud-ai-platform/devdiv/one-engineering-system-1es/1es-mohanb/security-integration/guardian-wiki/sdl-azdo-extension/roslyn-analyzers-build-task
#
# GOTCHA: This step will clobber any existing build output.  It should be run
# _before_ any build steps that perform versioning or signing.

# @TODO: This can probably be made generic and pass in the command lines for msbuild
#        BUT, they should be kept separate by now as we rebuild build.proj in parallel, we won't
#        affect >1 project at a time.

parameters:
  - name: sourceRoot
    type: string
    default: $(REPOROOT)

steps:
  - task: securedevelopmentteam.vss-secure-development-tools.build-task-roslynanalyzers.RoslynAnalyzers@3
    displayName: Roslyn Analyzers
    inputs:
      msBuildVersion: 17.0
      msBuildArchitecture: x64
      setupCommandlinePicker: vs2022
      msBuildCommandline: 'msbuild  ${{parameters.sourceRoot}}\build.proj -p:configuration=Release -p:GenerateNuget=false -p:BuildTools=false -p:SigningKeyPath=$(Agent.TempDirectory)\netfxKeypair.snk'
