#################################################################################
# Licensed to the .NET Foundation under one or more agreements.                 #
# The .NET Foundation licenses this file to you under the MIT license.          #
# See the LICENSE file in the project root for more information.                #
#################################################################################
parameters:

  - name: abstractionsAssemblyFileVersion
    type: string

  - name: abstractionsPackageVersion
    type: string
  
  - name: buildConfiguration
    type: string
    values:
      - Debug
      - Release

  - name: mdsAssemblyFileVersion
    type: string

  - name: mdsPackageVersion
    type: string

  - name: referenceType
    type: string
    values:
      - Package
      - Project

steps:
- task: DownloadSecureFile@1
  displayName: 'Download Key Pair'
  inputs:
    secureFile: netfxKeypair.snk
    retryCount: 5

- task: UseDotNet@2
  displayName: 'Use .NET 9.x sdk'
  inputs:
    packageType: sdk
    version: '9.x'

- task: UseDotNet@2
  displayName: 'Install .NET 8.x runtime'
  inputs:
    packageType: runtime
    version: '8.x'

- task: MSBuild@1
  displayName: 'BuildAllConfigurations using build.proj'
  inputs:
    solution: '**/build.proj'
    configuration: '${{ parameters.buildConfiguration }}'
    msbuildArguments: '-t:BuildAllConfigurations -p:ReferenceType=${{ parameters.referenceType }} -p:GenerateNuget=false -p:SigningKeyPath=$(Agent.TempDirectory)\netfxKeypair.snk -p:MdsPackageVersion=${{ parameters.mdsPackageVersion }} -p:AssemblyFileVersion=${{ parameters.mdsAssemblyFileVersion }} -p:AbstractionsPackageVersion=${{ parameters.abstractionsPackageVersion }} -p:AbstractionsAssemblyFileVersion=${{ parameters.abstractionsAssemblyFileVersion }}'
